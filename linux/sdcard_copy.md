# 리눅스 SD카드 복제(SD card Copy)
SD카드를 복제하는 방법에 대한 글이다. SD카드 복제는 일련의 과정으로 이루어진다. SD카드 디바이스를 이미지파일로 추출해서 
새로운 SD카드에 그 이미지파일들을 덮어 씌울 수도 있고, SD카드의 디바이스에서 새로운 SD카드로 직접 복제할 수도 있다. 여기서는
재사용성을 고려하여 전자의 방식을 설명한다. 주로 SD카드 복제는 라즈베리 파이나 SD카드에 OS를 올려서 작동시키는
임베디드 보드에서 이용된다.
  - 준비물: 원본SD카드, 새로운 SD카드, linux PC 
  
해당 과정은 linux 운영체제에 기본적으로 내장되어있는 [dd](https://man7.org/linux/man-pages/man1/dd.1.html) 라는 cli기반 프로그램을 이용한다.
위키피디아나 [나무위키](https://namu.wiki/w/%EB%94%94%EB%94%94?from=DD#s-17) 에도 잘 설명되어 있다.

순서는 아래와 같다.
1. 복사하려는 SD카드를 이미지 파일로 추출한다.
2. 덮어 씌워질 새로운 SD카드 장치명 확인.  
2.1. 사용 중인 SD카드일 때 원한다면 포맷.
3. dd 명령어를 사용해서 이미지파일 덮어 쓰기.


## 1. SD카드 추출
SD카드를 SD카드 어댑터를 통해 PC에 연결 후 장치명을 확인해준다. 확인 방법은 아래 명령어 참조.
```shell script
sudo fdisk -l
```
아마 usb 형태의 어댑터를 이용해서 micro SD카드를 연결했다면 아마 `/dev/sd<?>` 의 형태로 장치명이 설정 되어있을 것이다.
장치명을 확인하였다면 `dd` 명령어를 이용해서 `.img` 파일로 추출해준다. 아래 명령어는 장치명이 `/dev/sdc`라고 가정한 스크립트이다.
```shell script
dd if=/dev/sdc of=~/sd-card-image.img bs=8M
```
`if` 옵션은 복사할 대상을 `of` 옵션은 복사되어 쓰여질 경로를 적어준다. `bs` 옵션은 블록사이즈인데 sd카드가 16GB, 32GB, 64GB 등
 그 이상의 용량도 존재하는데 블록사이즈가 너무 작으면 오래걸리기에 적당히 8M를 주었다. 기본값은 512이다. 이렇게 진행을 하면 적게는 수십 분에서
 수 시간까지도 소요되는데 이 과정이 제대로 진행되고 있는지 터미널에 출력하고 싶다면 옵션으로 `status=progress` 를 적어준다. 아래와 같다.
```shell script
dd if=/dev/sdc of=~/sd-card-image.img bs=8M status=progress
```
파일이 써지는 속도도 출력되고 진행과정이 전체적으로 출력되어 나온다. 완료되면 기존의 마운트한 SD카드는 언마운트 해준다.

## 2. 새로운 SD카드 전처리
1번의 초기 내용과 같이 `sudo fdisk -l` 명령어를 이용해서 장치명을 확인해준다. 기존의 복제할 SD카드를 제거하고 
새로운 SD카드를 꽂았다면 장치명은 거의 동일할 것이다. `ex. /dev/sdc`  

* SD카드가 사용 중이거나 혹은 다른 이유로 SD카드 포맷을 하고 싶다면 [SD카드 포맷하기](sdcard_format.md)을 참조한다.

## 3. SD카드 이미지 복제
SD카드 이미지를 새로운 SD카드에 복제하는 방식은 1번의 이미지 추출과 똑같다. 아래 명령어를 참조하면 된다.
```shell script
dd if=~/sd-card-image.img of=/dev/sdc bs=16M status=progress
```
이미지 파일을 SD카드에 쓰는 작업은 SD카드를 이미지 파일로 추출하는 작업보다 시간이 오래걸린다.(bs 옵션이 없이 진행하면)
그래서 `bs` 옵션을 기존 8M에서 16M으로 올려주었다. 복제가 잘되고 있는지 동시에 확인을 위해 `status` 옵션도 넣어주었다.


복제가 완료되면 기존에 작동하던 보드 디바이스 등에 마운트 하여 제대로 작동되는지 확인한다.